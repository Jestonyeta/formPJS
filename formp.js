/*!
  FormPJS
  Author: Jestoni Amoyan (glennwilkinsd)
  Version: 1.0
 */
(function(a,b){b.FormPJS=function(f,o=null){if(f.tagName!='FORM'){alert('FormPJS Error: Element is not form');console.log('FormPJS Error');return false;}if(o===null){o={};};f.setAttribute('novalidate','');this.fjs_id=function(e){return document.getElementById(e)};this.fjs_tag=function(e){return document.getElementsByTagName(e)};this.fjs_name=function(e){return document.getElementsByName(e)};this.fjs_cl=function(e){return document.getElementsByClassName(e)};this.action=o.action?o.action:null;this.filesCount=0;this.filesInputs=[];this.finalfiles=[];this.net=new XMLHttpRequest();this.netform=new FormData();this.errdata;this.chunkedP=0;var fjstop=this;String.prototype.ext=function(){var type=this.toString();type=(type==='image/jpeg')?'image/jpg':type;return '.'+type.toString().split('/')[1];};fjstop.invalidfiles=[];fjstop.errorfields=[];fjstop.strlen=function(el){return (el.value.replace(/\s/g, '').length>0)?true:false;};fjstop.objsize=function(obj=null){if(obj===null||obj===undefined){return false;}if(typeof obj!='object'){return false;}return Object.keys(obj).length;};o.elems=[];o.inputs=f.getElementsByTagName('input');o.selects=f.getElementsByTagName('select');o.textarea=f.getElementsByTagName('textarea');for(var q=0;q<o.textarea.length;q++){if(o.textarea[q].name){o.elems.push(o.textarea[q]);}};for(var q=0;q<o.inputs.length;q++){if(o.inputs[q].name){o.elems.push(o.inputs[q]);}if(o.inputs[q].type==='file'){this.filesInputs.push(o.inputs[q]);}};for(var q=0;q<o.selects.length;q++){if(o.selects[q].name){o.elems.push(o.selects[q]);}};fjstop.reset=function(){console.clear();console.log('%c\x20\x46\x6f\x72\x6d\x50\x4a\x53\x20\x76\x31\x20\x4a\x65\x73\x74\x6f\x6e\x69\x20','background-color:rgb(110,199,87);border:1px solid #dedede;color:white;display:block;text-shadow:0 1px 0 rgba(0,0,0,0.3);line-height: 20px;text-align:center;font-weight:bold');fjstop.errorfields=[];fjstop.invalidfiles=[];fjstop.finalfiles=[];};fjstop.required=function(call){for(var q in o.required){fjstop.rm(fjstop.fjs_name(q),o.required[q],function(data){if(!data.state){fjstop.errorfields.push(data);}});};call(fjstop.errorfields);};fjstop.rm=function(el,obj,call){for(var q=0;q<el.length;q++){obj.value=el[q].value;obj.vCount=el[q].value.length;switch(el[q].type){case'file':call({state:fjstop.valfiles(el[q],obj),element:el[q],details:obj,invalidfiles:fjstop.invalidfiles});return;break;case'select-one':call({state:fjstop.valsel(el[q],obj),element:el[q],details:obj});return;break;case'checkbox':case'radio':call({state:fjstop.valcheck(el[q],obj),element:el[q],details:obj});return;break;case'color':call({state:fjstop.valcolor(el[q],obj),element:el[q],details:obj});return;break;case'range':call({state:fjstop.valrange(el[q],obj),element:el[q],details:obj});return;break;case'url':call({state:fjstop.valurl(el[q],obj),element:el[q],details:obj});return;break;default:call({state:fjstop.valtext(el[q],obj),element:el[q],details:obj});return;break;}}};fjstop.valurl=function(el,obj){if(!el.value.length){obj.error='empty';return false;}var upas=fjstop.Isurl(el.value)?'Valid':'Invalid';obj.error='Is '+upas+ ' Url';return fjstop.Isurl(el.value);};fjstop.Isurl=function(str){var regex=/(http|https):\/\/(\w+:{0,1}\w*)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%!\-\/]))?/;return regex.test(str);};fjstop.valrange=function(el,obj){if(obj.minval!=null&&obj.minval>el.value){obj.error='minval';return false;}if(obj.maxval!=null&&obj.maxval<el.value){obj.error='maxval';return false;}return true;};fjstop.valcolor=function(el,obj){if(!el.value){obj.error='Invalid Color';return false;}return true;};fjstop.valcheck=function(el,obj){if(!el.checked){obj.error=el.name+' is not checked';return false;}return true;};fjstop.valsel=function(el,obj){if(obj.maxlength!=null&&el.value.length>obj.maxlength){obj.error='maxlength';return false;}if(obj.minlength!=null&&el.value.length<obj.minlength){obj.error='minlength';return false;}if(obj.exindex===el.selectedIndex){obj.error='exindex';return false;}return true;};fjstop.valfiles=function(el,obj){obj.maxSize=(obj.maxSize!=null&&obj.maxSize!=undefined)?obj.maxSize:1000000*1000;obj.minSize=(obj.minSize!=null&&obj.minSize!=undefined)?obj.minSize:0;var fjs_inv=0;for(var q=0;q<el.files.length;q++){if(el.files[q].size>obj.maxSize||el.files[q].size<obj.minSize){obj.error=el.files[q].size;obj.errorFile=el.files[q];obj.errorType='file';fjstop.invalidfiles.push(el.files[q]);fjs_inv++;}}if(fjs_inv||el.files.length===0){return false;}return true;};fjstop.valtext=function(el,obj){if(!el.value.length){obj.error='empty';return false;}if(el.type==='email'){obj.val='email';}if(el.type==='number'){obj.val='int';}if(obj.maxlength!=null&&el.value.length>obj.maxlength){obj.error='maxlength';return false;}if(obj.minlength!=null&&el.value.length<obj.minlength){obj.error='minlength';return false;}if(obj.val!=null){switch(obj.val){case'email':var re=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;obj.error='email';if(!re.test(el.value)){return false;};break;case'fullname':obj.error='fullname';try{var nsp=el.value.split(' ');if(nsp.length>1){for(var q=0;q<nsp.length;q++){if(nsp[q].toString().replace(/\s/g, '').length===0&&q<2){return false;}}}else{return false;}}catch(e){};break;case'int':obj.error='int';if(!fjstop.strlen(el)){return false;};break;}}return true;};this.submit=function(e){e.preventDefault();fjstop.reset();o.submit();if(o.required!=null&&fjstop.objsize(o.required)){fjstop.required(function(data){if(fjstop.objsize(data)){o.validation(data);}else{fjstop.process();}});}else{fjstop.process();}return false;};this.process=function(){fjstop.uploadFiles(function(data){});};fjstop.uniqname=function(lim){var num=new Date().valueOf().toString();var lets='abcdefghijklmnopqrstuvwxyzwoskxqapoxldwiwksd';var res='';for(var w=0;w<lim;w++){res+=lets[Math.floor(Math.random() * lets.length)]+num[Math.floor(Math.random() * num.length)];}return res;};fjstop.uploadFiles=function(call){var buff=true,timer,ustart=0;fjstop.finalfiles=[];for(var q=0;q<fjstop.filesInputs.length;q++){for(var w=0;w<fjstop.filesInputs[q].files.length;w++){fjstop.filesInputs[q].files[w].fromelementname=fjstop.filesInputs[q].name;fjstop.filesInputs[q].files[w].ext=fjstop.filesInputs[q].files[w].type.ext();fjstop.filesInputs[q].files[w].uniqname=fjstop.uniqname(10)+fjstop.filesInputs[q].files[w].type.ext();fjstop.finalfiles.push(fjstop.filesInputs[q].files[w]);}}if(o.files.chunkUpload&&fjstop.objsize(o.files.chunkUpload)&&fjstop.finalfiles.length){var cSet=o.files.chunkUpload;cSet.allsize=0;for(var q=0;q<fjstop.finalfiles.length;q++){cSet.allsize+=fjstop.finalfiles[q].size;};fjstop.ChunkedFiles(fjstop.finalfiles,cSet);}else{fjstop.manualAjax(o.action,function(data){o.success(data);});}};fjstop.ChunkedFiles=function(els,settings){if(!settings.reciever){o.validation([{state:false,chunkUpload:true,reciever:false,element:false}]);return false;}var start=0,parentF=this;fjstop.chunkedP=0;parentF.Run=function(){if(start >= els.length){fjstop.manualAjax(o.action,function(data){o.success(data);},true);return false;}var bpc=(o.files.chunkUpload.size>els[start].size)?els[start].size:o.files.chunkUpload.size;fjstop.runChunked(els[start],bpc,settings,function(){start++;parentF.Run();});};parentF.Run();};fjstop.runChunked=function(el,bpc,settings,call){var blobs=[];var start=0,end=bpc,size=el.size,timer,buff=true,bstart=0;while(start<size){if(end>size){end=size;};blobs.push({file:el.slice(start,end),s:start,e:end});start+=bpc;end+=bpc;};timer=setInterval(function(){if(buff){buff=false;var ll=0;if(bstart >= blobs.length || !blobs.length){clearInterval(timer);buff=true;call();return false;}var net=fjstop.netRequest();var netform=fjstop.formData(); netform.append('file',blobs[bstart].file);if(o.files.uniqname){netform.append('filename',el.uniqname);}else{netform.append('filename',el.name);};netform.append('filetype',el.type);netform.append('filesize',el.size);netform.append('filedest',o.files.fileDest);netform.append('filestart',blobs[bstart].s);netform.append('fileend',blobs[bstart].e);netform.append('size',blobs[bstart].file.size);net.upload.onprogress=function(e){fjstop.chunkedP+=(e.loaded-ll);o.files.progress({loaded:fjstop.chunkedP,total:settings.allsize});ll=e.loaded;};net.onreadystatechange=function(){if(net.readyState===4){if(net.status===200){bstart++; buff=true;ll=0;}else{o.error(net.status+ ' '+net.statusText);ll=0;}}};net.open('POST',settings.reciever,true);net.send(netform);}},500);};fjstop.netRequest=function(){return new XMLHttpRequest();};fjstop.formData=function(){return new FormData();};fjstop.manualAjax=function(uri,call,fromChunk=false){var net=fjstop.netRequest(),netform=fjstop.formData();for(var q=0;q<o.elems.length;q++){if(o.elems[q].type!='file'){netform.append(o.elems[q].name,o.elems[q].value);}else{for(var w=0;w<o.elems[q].files.length;w++){if(!fromChunk){if(o.files.uniqname){netform.append(o.elems[q].name+'[]',o.elems[q].files[w],o.elems[q].files[w].uniqname);}else{netform.append(o.elems[q].name+'[]',o.elems[q].files[w]);}}else{if(o.files.uniqname){netform.append(o.elems[q].name+'[]',o.elems[q].files[w].uniqname);}else{netform.append(o.elems[q].name+'[]',o.elems[q].files[w].name);}}}}};netform.append('fileDest',o.files.fileDest);net.upload.onprogress=function(data){if(!fromChunk){o.files.progress(data);}};net.onreadystatechange=function(){if(net.readyState===4){if(net.status===200){call(net.responseText);}else{o.error(net.status + ' ' + net.statusText);}}};net.open('POST',uri,true);net.send(netform);return false;};f.onsubmit=this.submit;}}(document,window));